/* Expandable Code Blocks */
.expandable-code {
    position: relative;
    margin: 1rem 0;
    border-radius: 6px;
    overflow: hidden;
    transition: all 0.3s ease;
}

.expandable-code .chroma,
.expandable-code pre {
    position: relative;
    max-height: 400px;
    overflow-y: hidden;
    overflow-x: auto;
    transition: max-height 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.expandable-code.expanded .chroma,
.expandable-code.expanded pre {
    max-height: none;
    overflow-y: auto;
}

/* Fade overlay */
.expandable-code .chroma::after,
.expandable-code pre::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 60px;
    background: linear-gradient(transparent, var(--color-code-bg));
    pointer-events: none;
    transition: opacity 0.3s ease;
}

.expandable-code.expanded .chroma::after,
.expandable-code.expanded pre::after {
    opacity: 0;
}

/* When toggle exists, copy shifts left */
.code-toggle ~ .code-copy {
    right: 70px;
}

/* Expand/collapse button */
.code-toggle {
    position: absolute;
    top: 8px;
    right: 8px;
    background: rgba(43, 40, 37, 0.8);
    color: #e0def4;
    border: 1px solid rgba(224, 222, 244, 0.3);
    border-radius: 4px;
    padding: 4px 8px;
    font-size: 12px;
    cursor: pointer;
    transition: all 0.2s ease;
    z-index: 10;
    backdrop-filter: blur(4px);
}

.code-toggle:hover {
    background: rgba(43, 40, 37, 0.95);
    border-color: rgba(224, 222, 244, 0.5);
}

.code-toggle::before {
    content: 'Expand';
}

.expandable-code.expanded .code-toggle::before {
    content: 'Collapse';
}

/* Copy button - positioned right when no toggle, left of toggle otherwise */
.code-copy {
    position: absolute;
    top: 8px;
    right: 8px;
    background: rgba(43, 40, 37, 0.8);
    color: #e0def4;
    border: 1px solid rgba(224, 222, 244, 0.3);
    border-radius: 4px;
    padding: 4px 8px;
    font-size: 12px;
    cursor: pointer;
    transition: all 0.2s ease;
    z-index: 10;
    backdrop-filter: blur(4px);
}

.code-copy:hover {
    background: rgba(43, 40, 37, 0.95);
    border-color: rgba(224, 222, 244, 0.5);
}

.code-copy::before {
    content: 'Copy';
}

.code-copy.copied::before {
    content: 'Copied!';
    color: #9ccfd8;
}

/* Expandable code content */
.expandable-code .chroma pre,
.expandable-code pre {
    margin: 0;
    padding: 1rem;
    overflow-x: auto;
}

.expandable-code:not(.expanded) .chroma .lnt {
    opacity: 0.8;
}

.expandable-code:not(.expanded):hover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

/* Focus states */
.code-toggle:focus,
.code-copy:focus {
    outline: 2px solid var(--color-accent);
    outline-offset: 2px;
}

@media (max-width: 768px) {
    .code-copy {
        padding: 3px 6px;
        font-size: 11px;
    }
    .code-toggle ~ .code-copy {
        right: 60px;
    }
    .code-toggle {
        padding: 3px 6px;
        font-size: 11px;
    }
}
